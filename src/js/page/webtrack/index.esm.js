function E(n){var t=n.tagName.toLowerCase(),e=t;return Array.prototype.slice.call(n.attributes).forEach(function(r){n.outerHTML.includes(r.name)&&(e+="["+r.name+'="'+r.value+'"]')}),e}function f(n){let t=n.parentElement;return!t||t.tagName=="HTML"?"html":f(t)+">"+t.tagName.toLowerCase()}function y(n){var t=f(n),e=E(n);return t+">"+e}var l={},h=["Object","Array","Map","Set","Number","Boolean","String","Date","RegExp","Function","Promise","Symbol","BigInt","Error","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint16Array","Uint32Array","Uint8ClampedArray","ArrayBuffer","SharedArrayBuffer"];function m(n){var t=[];if(n)do{let e=n.constructor?.name,r=h.includes(e);h.includes(e)&&(l[e]||(l[e]=[...Object.getOwnPropertyNames(globalThis[e].prototype)])),Object.getOwnPropertyNames(n).forEach(function(i){r&&l[e].includes(i)||t.indexOf(i)===-1&&t.push(i)})}while(n=Object.getPrototypeOf(n));return t}var d=(n,t={})=>{let e=[];return m(n).forEach(i=>{if(/^on/.test(i)){let a=i.slice(2);t.callback&&n.addEventListener(a,t.callback),(!t.ignore||!t.ignore.includes(a))&&e.push(a)}}),e};var g={},T=["clientX","clientY","deltaX","deltaY","deltaZ","deltaMode","animationName","propertyName","pseudoElement","elapsedTime","pressure","tangentialPressure","tiltX","tiltY","twist","pointerType","azimuthAngle","altitudeAngle","alpha","beta","gamma","absolute","key","location","repeat","isComposing","ctrlKey","shiftKey","altKey","metaKey"],b=class{constructor(){this.on=!1;this.events={};this.raw={};this.#r={};this.#n=[];this.watch=t=>{if(typeof t=="function"&&(this.#t=t),!this.on&&(this.on=!0,this.register(globalThis),globalThis.document&&this.register(globalThis.document),globalThis.window)){let e=document.getElementsByTagName("*");for(let r=0;r<e.length;r++)this.register(e[r])}};this.clear=()=>{this.#e.disconnect(),this.on=!1,this.#n.forEach(t=>t()),this.#n=[]};this.set=(t,e)=>{t=t.toLowerCase(),this.#r[t]=e};this.register=t=>{let e=t.tagName?t.tagName.toLowerCase():t===globalThis?"globalThis":"document",r=g[e];r||(g[e]=r=d(t)),t instanceof HTMLElement&&this.#e.observe(t,{childList:!0,subtree:!0}),r.forEach(i=>{this.raw[i]||(this.raw[i]=[]);let a=()=>t.removeEventListener(i,c),c=s=>{let u=s.target===document;if(s.target===t||u){this.raw[s.type].push(s);let o=this.compress(s);this.events[s.type]||(this.events[s.type]=[]),this.events[s.type].push(o);let p=u?"document":e;this.#t&&this.#t(o,p),this.#r[e]&&this.#r[e](o,p)}};t.addEventListener(i,c),this.#n.push(a)})};this.compress=t=>{let e={timestamp:t.timeStamp,target:t.target,type:t.type};return T.forEach(r=>{r in t&&(e[r]=t[r])}),e};this.stringify=t=>{try{return JSON.stringify(t,(e,r)=>r instanceof Element?y(r):r instanceof Node?r.nodeName:r instanceof Window?"Window":r," ")}catch(e){console.warn("Failed to pass event type",t.type,e);return}};this.#e=new MutationObserver(t=>{for(let e of t)e.type==="childList"&&e.addedNodes.forEach(r=>this.register(r))})}#t;#e;#r;#n};export{b as Watcher};
